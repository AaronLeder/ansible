---
# ===== Connectivity ===== #
- name: Proxmox Host Connectivity
  hosts: localhost
  connection: local
  gather_facts: false  

  vars_files:
    - ../vault/aaron-homelab.yml
  roles:
    - proxmox
  tags: 
    - pve_connectivity

# ===== VM State ===== #
- name: Proxmox Change VM State
  hosts: proxmox
  connection: local
  gather_facts: false

  vars:
    pve_api_host: "walnut"   # or FQDN
    pve_api_user: "ansible@pve"
    pve_api_token_name: "ansible-maint001"
    pve_api_token_id: "{{ pve_api_user }}!{{ pve_api_token_name }}"
    pve_validate_certs: false
    pve_timeout: 300
    # Define the state. You can leave this empty to skip.
    pve_vm_state: stopped
    # Define which VMs to modify on which Proxmox host
    # Acceptable formats: [151, 152] or [151,152] or list
    pve_vm_map:
      walnut: [151,152]
      rainbow: []
      cheddar: []
      squeak: []

  vars_files:
    - ../vault/aaron-homelab.yml
  roles:
    - proxmox
  tags:
    - pve_state_vms

# ===== VM Clone ===== #
- name: Clone Proxmox VMs for hosts in pve_vms_to_clone
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    pve_api_host: "walnut"   # or FQDN
    pve_api_user: "ansible@pve"
    pve_api_token_name: "ansible-maint001"
    pve_api_token_id: "{{ pve_api_user }}!{{ pve_api_token_name }}"
    pve_validate_certs: false
    pve_timeout: 300

    # Clone params
    pve_clone_template_id: 100      # Proxmox template VMID to clone
    pve_clone_target_node: walnut   # Node where the template resides (and default target node)
    pve_clone_storage: mydata       # Target storage for full clones
    pve_clone_format: qcow2         # Disk format (may be ignored/invalid on some storage types)
    pve_clone_pool: ""              # Optional pool name (empty = omit)
    pve_clone_vmid_start: 100       # Starting VMID when a host does not define pve_vmid
    pve_clone_full: true            # full clone vs linked clone
    pve_clone_timeout: 900          # seconds

  vars_files:
    - ../vault/aaron-homelab.yml
  roles:
    - proxmox
  tags:
    - pve_clone_vms
